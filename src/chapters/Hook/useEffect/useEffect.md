

React认为一个附件应该是纯粹的，它应该根据外部传入的props或自身的state发生变化。除了组件自身的state或外部传入的props，凡是会对外部产生影响的操作就是副作用操作。



常见的副作用操作有：

- ajax请求
- 计时器
- 其他的异步操作，比如更改真实dom对象，本地存储等。

可以认为，除了props和自身的state，凡是对外部会产生影响的操作，就是副作用操作。



```js
function useEffect(effectFn, relateData);
```

useEffect接受一个回调函数，该回调函数就是副作用函数。在每次组件渲染完成后（UI完成更新），副作用函数就会执行。

useEffect也可以返回一个函数，该函数的执行时机如下：

- 组件第一次初始化时不会执行，之后在每次执行副作用函数之前都会执行。
- 组件销毁时执行。

useEffect返回的函数可以认为是清理函数，即当组件销毁时，或者组件每次渲染时执行一些清理动作。

useEffect函数有第二个参数，它是一个数组，是该副作用函数的依赖数据。如果提供了第二个参数，那么当组件重新渲染后，副作用函数依赖的数据发生变化时它才会执行。

也就是说提供的依赖数据没发生变化，那么该副作用函数仅在第一次渲染后运行，且清理函数仅在卸载组件后执行。

注: React会对依赖项数组中的每一项进行比较，使用Objec.is()进行比较。



使用注意：副作用函数中，如果使用了函数上下文中的变量，则由于闭包的影响，会导致副作用函数中的变量不会实时变化。



> componentDidMount()、componentDidUpdate与effect的区别
>
> 这俩个声明周期函数是在改变真实DOM，但是浏览器还未重新绘制的时候触发（用户还未看见UI更新）。effect的副作用函数，是在更改了真实dom，并且用户已经看见了UI更新，然后才执行。所以它的执行是异步的。